# 01. 无头代理人核心

## 最终核心架构：一个纯粹的「事件驱动执行引擎」

在「一切皆插件」和「保持核心绝对纯净」的最终设计哲学指导下，「无头代理人核心」的定位被进一步精炼。它是一个**纯粹的、单线程的、异步的「事件驱动执行引擎」**。

它的核心不再是针对 `UI` 或 `MCP` 的特定「钩子 (Hook)」，而是**一个统一的「内部事件队列 (Internal Event Queue)」**。核心的所有行为都由处理此队列中的事件来驱动。

## 核心职责概述

代理人核心的职责可以被看作是围绕「事件队列」构建的一套标准化处理流程。

1.  **事件队列 (Internal Event Queue) - [新核心]**:
    *   作为核心**唯一的输入源**，接收来自各类「监听器插件」的标准化事件。
2.  **执行循环 (Execution Loop) - [职责简化]**:
    *   不再监听外部，只负责从「事件队列」中取出事件，并根据事件类型触发后续流程（通常是打包上下文并调用 LLM）。
3.  **插件基础设施 (Plugin Infrastructure):**
    *   职责不变，但新增了对 **`listener`** 类型插件的支持。
4.  **监听器插件 (Listener Plugin) - [受蕴]**:
    *   一种主动的、长时程运行的插件，负责**将外部的异步事件转化为标准事件**并推入「事件队列」。
    *   例如，CLI stdin 监听器接收用户终端输入，并将其作为 `user_input` 事件推入队列。
    *   `MCP` 的消息接收能力，则由一个 `MCP_Listener` 插件来实现。
5.  **UI 插件 (UI Plugin) - [色蕴]**:
    *   UI 插件有独立的 `IUI` 接口，负责接收事件并呈现输出。
    *   Listener 插件 (受蕴) 专注于接收外部输入。两者各司其职，不再混合。
6.  **安全层 (Security Layer) & 状态管理器 (State Manager):**
    *   职责维持不变，依然是执行循环中的关键处理环节。

---

通过这次精炼，核心本身变得与任何特定的输入源（UI、消息总线、Webhook）完全解耦。只要一个功能可以被实现为一个向「事件队列」推送消息的 `Listener` 插件，核心就能处理它。这为系统提供了极致的灵活性和纯粹性。