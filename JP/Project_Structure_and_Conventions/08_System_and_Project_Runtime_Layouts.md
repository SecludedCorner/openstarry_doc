# 08. システム級およびプロジェクト級ランタイムレイアウト (System & Project Runtime Layouts)

このドキュメントでは、 **"Directory as Permission"** という核心的な哲学を具体化します。 OpenStarry は、権限の隔離と環境のポータビリティを実現するために、「グローバルシステム空間」と「ローカルプロジェクト空間」を区別します。

---

## 1. システムグローバル空間 (System-wide Space)

これは Orchestrator Daemon のメインディレクトリであり、通常はユーザーのホームフォルダ直下に位置します。

*   **パス (Windows)：** `%USERPROFILE%\.openstarry`
*   **パス (Linux/macOS)：** `~/.openstarry/`

### ディレクトリ構造

```text
~/.openstarry/
├── daemon.pid              # Daemon プロセスのロックファイル
├── config.json             # Daemon グローバル設定ファイル (API Port, ストレージパスなど)
├── agents/                 # [システム級エージェント] Daemon によってホストされるすべての実体
│   ├── agent-001/          # ドキュメント 04 で定義された標準ディレクトリに準拠
│   └── agent-002/ 
│   
├── plugins/                # [システム級プラグイン] グローバルに利用可能なツールとプロバイダー
│   
├── storage/                # グローバルな永続化データ
│   └── main.db             # SQLite/LevelDB (エージェントの状態インデックスを保存)
│   
└── logs/                   # Daemon システムログ
```

---

## 2. プロジェクトローカル空間 (Project-specific Space)

開発者が特定のプロジェクトディレクトリで OpenStarry を起動すると、システムは自動的にプロジェクト空間を認識します。

*   **パス：** `[Your-Project-Path]/.openstarry/`

### ディレクトリ構造

```text
.openstarry/
├── agent.json              # プロジェクト専用のエージェント設定
├── plugins/                # [プロジェクトプラグイン] このプロジェクトのみに公開される能力
│   └── custom-tools/       # プロジェクトプライベートツール
│   
├── data/                   # プロジェクトが生成したローカルデータ
│   
└── logs/                   # プロジェクト実行ログ
```

---

## 3. ロード優先順位とオーバーレイメカニズム (Overlay Mechanism)

OpenStarry は、 Linux の UnionFS に似たロードロジックを採用しています。エージェントがプラグインや設定を探す際の検索順序は以下の通りです：

1.  **プロジェクト空間 ( `./.openstarry/` )**：最高優先順位。カスタマイズやデバッグに使用されます。
2.  **システム空間 ( `~/.openstarry/` )**：標準的な能力の提供者。
3.  **内蔵空間 (Built-in)**：バイナリファイルと共に配布される元のデフォルト設定。

### 権限セキュリティ原則

*   **隔離性**：プロジェクトエージェントは、明示的に権限を与えられない限り、デフォルトではシステム空間の他のエージェントのデータにアクセスできません。
*   **読み取り専用**：システム級プラグインは、プロジェクト級の誤操作によってシステムの安定性が損なわれるのを防ぐため、通常、プロジェクトエージェントからは読み取り専用となります。

---

## 4. 哲学的なマッピング

*   **システム空間 = 「大環境」**：デジタル種が生存する共通のエコシステム。
*   **プロジェクト空間 = 「棲息地」**：デジタル種の具体的な実行領域。
*   **ディレクトリ即権限**：プラグインが `~/.openstarry` に置かれるか、それとも `./.openstarry` に置かれるかによって、その信頼レベルと公開範囲が直接決定されます。
