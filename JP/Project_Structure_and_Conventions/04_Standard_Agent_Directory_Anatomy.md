# 03. 標準エージェントディレクトリ解剖学と階層仕様 (Standard Agent Directory Anatomy & Hierarchy)

このドキュメントでは、 OpenStarry システムにおける「エージェント・ワークスペース」の標準的なレイアウトを定義します。この仕様は、 **システム級 (System-level)** および **プロジェクト級 (Project-level)** の環境の両方に適用されます。

## 核心的な哲学：自己相似性 (Self-Similarity)

OpenStarry において、システム管理者（ System Agent ）と具体的な実行者（ Project Agent ）は、物理的な構造において完全に左右対称です。この「フラクタル」な設計により、将来的にあらゆるプロジェクトが別のサブシステムのマネージャーへと進化する可能性が確保されます。

---

## 標準ディレクトリ構造 (The Anatomy)

システムパスであれプロジェクトパスであれ、必ず以下のレイアウトに従わなければなりません：

```text
[Agent_Root]/
├── plugins/           # 集合体プラグイン格納エリア (Aggregates)
│   ├── tool-A/        # プラグイン A
│   └── listener-B/    # プラグイン B
├── configs/           # エージェントのブループリントと設定 (Manifests)
│   └── agent.json     # そのエージェントがどのプラグインをロードするかを定義
├── states/            # ステートと永続化 (States/Snapshots)
│   └── memory.db      # 識蘊 (Vijnana) の物理ストレージ
└── logs/              # 実行時ログ (受蘊の履歴記録)
```

---

## プラグインの発見と継承メカニズム

エージェントの起動時、その `PluginLoader` は複数の階層の `plugins/` ディレクトリをスキャンします：

1.  **優先順位 1 (プロジェクト級)：** `[Current_Project_Root]/plugins/`
2.  **優先順位 2 (システム級)：** `[openstarry_system_root]/plugins/`

**規則：**
*   プロジェクトエージェントは、リソース共有を実現するためにシステム級プラグインを **呼び出すことができます** （例：システムが統一して提供する `git-tool` を使用するなど）。
*   両方の場所に同名のプラグインが存在する場合、 **プロジェクト級が優先** され、プロジェクトがシステムのデフォルトの挙動を上書きすることを許可します。

---

## 役割の権限と隔離 (Security Policy)

構造は同じですが、異なる階層のエージェントは厳格な責務の制限を受けます：

### 1. システム・エージェント (System Agent / Manager)
*   **常駐場所：** `openstarry_system_root`
*   **核心的タスク：** プロジェクトエージェントのライフサイクル管理（作成、監視、破棄）。
*   **厳格な制限：** **いかなる業務プラグイン（ WhatsApp 、データベース操作ツールなど）のロードも厳禁します。**
*   **操作ロジック：** システムエージェントが業務操作を実行する必要がある場合、代行させるための特定の「プロジェクトエージェント」を起動しなければなりません。システムエージェント自身は `AgentManagerTool` のみを保持します。

### 2. プロジェクト・エージェント (Project Agent / Worker)
*   **常駐場所：** 具体的なプロジェクトディレクトリ。
*   **核心的タスク：** 具体的な業務の実行。
*   **操作ロジック：** 自身のディレクトリ下の `plugins/` 内にあるすべてのツールに対する完全な操作権限を持ちます。

---

## 強制終了メカニズム (The Kill Switch)

システムエージェントと人間の管理者は、プロジェクトエージェントに対して最高の制御権を持ちます：

1.  **プロセス制御：** システムエージェントは `Orchestrator Daemon` を通じてプロジェクトエージェントの PID を維持します。
2.  **強制終了：** プロジェクトエージェントが制御不能になった場合やタスクが完了した場合、システムエージェントは `SIGKILL` シグナルを送信できます。
3.  **哲学的意義：** これは、「識蘊（主体意識）」による「行蘊（行動）」への絶対的な制御を表しています。ある行動がもはやシステムの目標に合致しなくなったとき、管理センターは物理的にエネルギー供給を遮断（プロセスを終了）できなければなりません。
