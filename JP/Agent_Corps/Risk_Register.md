# OpenStarry Agent Corps — リスク登録簿 (Risk Register)

設立日：2026-02-09

**評価基準**：確率 (L/M/H) × 影響 (L/M/H) = リスクレベル (Low/Medium/High/Critical)

---

## 技術的リスク

### R-T01: Agent Context Window の溢れ
- **確率**: H （大規模な機能実装時にはほぼ確実に発生）
- **影響**: M （エージェントの出力が不完全になる、または詳細が漏れる）
- **リスクレベル**: High
- **トリガーシナリオ**: dev-core が大量の既存コード + 仕様書を読み込み、大量の変更を書き込む必要がある場合
- **緩和戦略**:
  - コーディネーターが大きな機能を複数の小さなタスクに分割し、段階的に派遣する
  - エージェントのプロンプトで、読み込むべきファイルを必要最小限に指定する
  - 複雑な変更を Step 2a / 2b / 2c の多段階に分ける
- **対応計画**: 出力が不完全な場合、コーディネーターが完了部分を確認し、新しいエージェントセッションを派遣して継続する

### R-T02: agent_test での pnpm install または build の失敗
- **確率**: M
- **影響**: M （Phase 2.5/3 が停滞する）
- **リスクレベル**: Medium
- **トリガーシナリオ**: 依存関係の衝突、ワークスペースプロトコルの問題、Windows のパスの問題
- **ステータス**: **発生済み**（Cycle 18 Phase 2.5）— 古い node_modules（yaml/vitest モジュール解決の失敗）
- **緩和戦略**:
  - 同期スクリプトで `pnpm-lock.yaml` をコピーし、依存関係の一致を確保する
  - Phase 2 の完了基準で build pass を要求する（理論上、同期後も通過するはず）
  - **NEW (Cycle 18 の教訓)**：node_modules クリーンアップ基盤の構築（Plan16+ タスク）
- **対応計画**:
  - 同期後のビルドが失敗し、agent_dev でのビルドが通過する場合 → 同期スクリプトでファイルの漏れがないか確認する
  - または手動で node_modules のクリーンアップと pnpm install を実行する
  - Plan16: CI フックで古い node_modules を自動クリーンアップする機能を実装する（サイクル間の環境清掃）

### R-T03: Windows 環境の互換性
- **確率**: M
- **影響**: M （スクリプトやツールが期待通りに動作しない）
- **リスクレベル**: Medium
- **トリガーシナリオ**: bash スクリプトが Windows Git Bash で異なる挙動をする、パス区切り文字、シンボリックリンク非対応
- **緩和戦略**:
  - スクリプトで `$(cd ... && pwd)` を使用して絶対パスを取得する
  - シンボリックリンクを避け、`cp` によるコピーを使用する
  - スクリプトで `2>/dev/null || true` を使用して非致命的なエラーを処理する
- **対応計画**: 失敗したステップを手動で実行し、問題を記録して後でスクリプトを修正する

### R-T04: プラグインが依存する SDK バージョンの不一致
- **確率**: M
- **影響**: H （プラグインのビルド失敗、ランタイムでの型不一致）
- **リスクレベル**: High
- **トリガーシナリオ**: dev-core が SDK インターフェースを変更したが、dev-plugin が旧版の SDK を使用している場合
- **緩和戦略**:
  - Interface Freeze メカニズムにより仕様書を凍結する
  - Phase 2 Step 2a でまず SDK を完成させ、ビルドを確認してから dev-plugin を派遣する
  - ワークスペースプロトコル（`workspace:*`）によりローカルバージョンを自動リンクする
- **対応計画**: 仕様書追記 (Spec Addendum) プロセスにより、必要なインターフェース変更を処理する

---

## プロセス上のリスク

### R-P01: コーディネーターのメインセッションのクラッシュ
- **確率**: M （長時間作業、Token の枯渇）
- **影響**: H （反復の中断、状態の不整合の可能性）
- **リスクレベル**: High
- **緩和戦略**:
  - すべての状態をファイルで永続化する（報告書 = 暗黙の状態マーカー）
  - SOP 8.3 で状態の判断方法を定義する
  - 各フェーズの成果物は独立したファイルであり、セッションの記憶に依存しない
- **対応計画**: 新しいセッションで SOP を読み込み、cycle ディレクトリを確認 → フェーズを判断 → 継続

### R-P02: リワーク (Rework) の無限ループ
- **確率**: L
- **影響**: H （反復がいつまでも終わらない）
- **リスクレベル**: Medium
- **トリガーシナリオ**: 設計の欠陥により FAIL が繰り返され、リワークのたびに新しい問題が混入する
- **緩和戦略**:
  - リワークの上限を2回とし、それを超える場合は User へ強制エスカレーションする
  - リワークのたびに Baseline を再構築する
- **対応計画**: User がそのプランを断念するか、大幅な再設計を行うかを裁決する

### R-P03: エージェントの出力品質のばらつき
- **確率**: M
- **影響**: M （不適切な入力による不適切な出力、Phase 3 で発覚）
- **トリガーシナリオ**: エージェントへのプロンプトが不明確、エージェントが仕様書を誤解する
- **緩和戦略**:
  - 通信プロトコルで必要なプロンプトフィールドを定義する
  - Phase 3 での二重検証（qa + architect）
  - すべての変更をレビュー用に開発ログに記録する
- **対応計画**: リワークプロセスで対応する

### R-P04: 報告書やドキュメントの内容の衝突
- **確率**: L
- **影響**: L （混乱を招くが致命的ではない）
- **トリガーシナリオ**: 複数のエージェントが同時に隣接するファイルに書き込む、doc-keeper とコーディネーターが同時に Iteration_Log を更新する
- **緩和戦略**:
  - 各エージェントに明確な書き込みディレクトリを割り当て、重複させない
  - doc-keeper を Iteration_Log の唯一の書き込み者とする
- **対応計画**: コーディネーターが衝突を発見した際に手動でマージする

### R-P05: 統合ポイントの欠落 (Integration Point Missing)
- **確率**: M （新機能の統合時に見落としやすい）
- **影響**: M （機能が動作しない、Phase 3 で発覚）
- **トリガーシナリオ**: Phase 2 の実装で独立モジュールを作成したがメインフローに統合していない、または TODO コメントで実際のコードを代用した
- **ステータス**: 発見済み、Cycle 7 FAIL-1（import analysis が sandbox-manager に統合されていなかった）
- **緩和戦略**:
  - Phase 1 の仕様書にすべての統合ポイントを明示する
  - Phase 2 のコードレビューチェックリスト：統合ポイントに TODO/FIXME コメントがないか確認する
  - Phase 2 で「統合テスト」を設け、各統合ポイントが呼び出されていることを検証する
- **対応計画**: 今後の新機能には明確な「統合検証テスト」を必須とし、省略を認めない

### R-P06: 仕様書の項目漏れ (Spec Omission)
- **確率**: M （複雑な仕様書では漏れが起きやすい）
- **影響**: M （実装は完了しても仕様書で定義されたコンポーネントが未作成、Phase 3 で FAIL）
- **トリガーシナリオ**: アーキテクチャ仕様書がファイル/コンポーネント一覧を定義しているが、Phase 2 ですべて作成されていない（例：Cycle 7 の plugin-signer パッケージ）
- **ステータス**: 発見済み、Cycle 7 FAIL-2（plugin-signer パッケージが仕様書にあったが未実装）
- **緩和戦略**:
  - Phase 2 開始前に、コーディネーターが「仕様書ファイル一覧チェックリスト」を作成する
  - Phase 2 終了時にチェックリストを強制的に逐項検証する
  - 開発ログに「作成したファイル一覧」を記録し、確認に供する
- **対応計画**: 今後の新プラン開始前に必ずチェックリストを準備する

### R-P07: 未検証の仮定 (Unvalidated Assumptions)
- **確率**: M （複雑なシステムでは暗黙の仮定が多い）
- **影響**: M （特定の条件下でコードパスがクラッシュする、例：package-name プラグイン）
- **トリガーシナリオ**: コードがある条件の成立を仮定している（例：「すべてのプラグインにファイルパスがある」）が、入力バリデーションで確認していない
- **ステータス**: 発見済み、Cycle 7 FAIL-3（signature verification が filePath の存在を仮定していた）
- **緩和戦略**:
  - Phase 1 の仕様書にすべての境界条件 (boundary conditions) を列挙する
  - Phase 2 で各仮定に対して明示的なガード（if チェック）を設ける
  - テストで境界ケース（package-name プラグイン、null 値など）をカバーする
- **対応計画**: コードレビューチェックリストに「仮定の検証」項目を追加する

---

## 外部的リスク

### R-E01: Claude Pro Token 枠の枯渇
- **確率**: M （大規模な反復では大量の Token を消費する可能性がある）
- **影響**: H （反復全体が停止を余儀なくされる）
- **緩和戦略**:
  - doc-keeper は haiku を使用する（低コスト）
  - 必要なときだけエージェントを派遣し、不必要な呼び出しを避ける
  - 大きな機能を複数の小さな反復サイクルに分割する
- **対応計画**: 反復を一時停止し、枠の回復を待つ。SOP 8.3 の状態判断に基づき復旧する

### R-E02: リファレンスプロジェクトのバージョンの陳腐化
- **確率**: L
- **影響**: L （調査報告が古い情報に基づいている）
- **トリガーシナリオ**: `share/ref/` 内の openclaw/opencode/openoctopus が更新されなくなる
- **緩和戦略**: 調査担当者が報告書に参照したバージョンと日付を明記する
- **対応計画**: 必要に応じて `share/ref/` を手動で更新する

---

## リスク概要

| ID | リスク | レベル | ステータス |
|----|------|:----:|:----:|
| R-T01 | Context Window の溢れ | High | 監視中 |
| R-T02 | agent_test ビルド失敗 | Medium | 発生済み（Cycle 18）、緩和待ち（基盤整備） |
| R-T03 | Windows 互換性 | Medium | 監視中 |
| R-T04 | SDK バージョンの不一致 | High | 緩和済み (Interface Freeze) |
| R-P01 | メインセッションのクラッシュ | High | 緩和済み (状態永続化) |
| R-P02 | リワークの無限ループ | Medium | 緩和済み (上限2回) |
| R-P03 | 出力品質のばらつき | Medium | 緩和済み (Communication Protocol) |
| R-P04 | 報告内容の衝突 | Low | 緩和済み (出力ディレクトリの分離) |
| R-P05 | 統合ポイントの欠落 | Medium | 発見済み（Cycle 7）、緩和待ち（チェックリスト） |
| R-P06 | 仕様書の項目漏れ | Medium | 発見済み（Cycle 7）、緩和待ち（チェックリスト） |
| R-P07 | 未検証の仮定 | Medium | 発見済み（Cycle 7）、緩和待ち（Guard チェック） |
| R-E01 | Token 枠の枯渇 | Medium | 監視中 |
| R-E02 | リファレンスプロジェクトの陳腐化 | Low | 受容 |
