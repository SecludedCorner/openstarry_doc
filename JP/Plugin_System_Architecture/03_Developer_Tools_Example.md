# プラグイン例：デベロッパーツール (Developer Tools)

このドキュメントでは、コード検索や LSP など、コード開発に関連する高度なツールプラグインの設計思想について説明します。

---

### 1. コード検索 ( `code:search` )

*   **プラグインタイプ：** `tool`
*   **責務：** エージェントのワークスペース内で、高速かつ正確なコード検索を実行します。
*   **`plugin.json` の例：**
    ```json
    {
      "name": "Code-Search",
      "type": "tool",
      "entryPoint": "./CodeSearchTool.js"
    }
    ```
*   **実装の考え方：**
    1.  `CodeSearchTool.js` の `execute` メソッドは、検索パターン `pattern` や、オプションのファイルタイプ `glob` などの引数を受け取ります。
    2.  バックエンドで `ripgrep (rg)` などの高性能なコマンドラインツールを呼び出します。
    3.  安全性のために、この呼び出しも `SandboxManager` を介してコンテナ内で実行されるべきです。これにより、検索範囲が現在のセッションのワークスペース内に厳格に制限されることが保証されます。
    4.  検索結果のサマリーを LLM に返します。

---

### 2. LSP (Language Server Protocol)

LSP サポートの実装は比較的複雑です。これは長時間実行されるプロセスの管理を伴うため、 **ステートフル（状態を持つ）なツール** と言えます。

*   **プラグインタイプ：** 複数の関連する `tool` を含むツールセット。
*   **責務：** エージェントにコードのセマンティクス（意味論）を理解する能力（定義へのジャンプ、型情報の取得、コード補完など）を与えます。
*   **実装の考え方：**
    1.  **バックエンド `LspProcessManager`：** 言語サーバーのプロセスを管理するためのバックエンドモジュールが必要です。これはプロジェクトやセッションごとに、対応する言語サーバープロセス（ `typescript-language-server` など）を起動し、維持します。
    2.  **`lsp:start` Tool：**
        *   機能：バックエンドで現在のプロジェクトに対して指定された言語の LSP サービスを起動します。
        *   戻り値：後続の対話で使用する `server_id` 。
    3.  **`lsp:request` Tool：**
        *   機能：起動済みの LSP サービスに対して標準の LSP リクエストを送信します。
        *   引数： `{ server_id: string, method: string, params: object }` 。例えば、 `method: 'textDocument/definition'`, `params: { textDocument: { uri: '...' }, position: { ... } }` など。
        *   実装：このツールは `LspProcessManager` を介して対応するサーバープロセスを見つけ、標準入出力 (stdin/stdout) を通じて通信し、 JSON-RPC リクエストを送信して応答を待ちます。
    4.  **`lsp:stop` Tool：**
        *   機能：実行中の LSP サービスを終了します。

この設計では、ステートフルなプロセス管理をバックエンドに配置し、 LLM に提供するのは一連のステートレスで呼び出し可能な `Tool` インターフェースのみとしています。
