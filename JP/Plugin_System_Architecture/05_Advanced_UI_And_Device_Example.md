# プラグイン例：高度な UI とデバイス統合

このドキュメントでは、テキストを超えた高度な UI およびデバイス統合プラグインの設計思想について説明します。

---

### 1. Canvas UI

このタイプの UI プラグインを使用すると、エージェントはテキストだけでなく、グラフィカルで視覚的な出力を作成し、操作することができます。

*   **プラグインタイプ：** `ui`
*   **責務：**
    1.  「双方向通信インターフェース」を実装すること。
    2.  グラフィック描画領域（ HTML Canvas など）を提供すること。
    3.  コアからの「メッセージ」を「描画指示」として解析すること。
*   **`plugin.json` の例：**
    ```json
    {
      "name": "Canvas-Visualizer-UI",
      "type": "ui",
      "entryPoint": "./CanvasUI.js"
    }
    ```
*   **実装の考え方：**
    *   **アウトバウンド (コア -> UI)：** `CanvasUI.js` は `onNewMessage` イベントを監視します。メッセージの `metadata` や形式を確認し、メッセージが描画指示（例： `{ type: 'draw_command', shape: 'rectangle', coords: [10, 10, 50, 50], color: 'red' }` ）であれば、 Canvas 上に対応する図形を描画します。普通のテキストメッセージであれば、 Canvas の特定の領域にテキストを表示します。
    *   **インバウンド (UI -> コア)：** `CanvasUI.js` は Canvas 上のマウスクリックなどのイベントを監視します。ユーザーが Canvas をクリックすると、クリック座標 `{ x: 55, y: 120 }` をユーザー入力としてパッケージ化し、 `submitUserInput` を通じてコアに送信します。これにより、 LLM はユーザーがどこをクリックしたかを知り、反応することができます。

---

### 2. デバイス統合 (Device Integration)

デバイス統合は、 `Tool` と `Listener` の2つのプラグインを通じて実現でき、エージェントが物理世界を感知し、それと対話することを可能にします。

#### `Tool` として（能動的な取得）

*   **プラグインタイプ：** `tool`
*   **例：**
    *   `device:get_location`：デバイスの GPS 座標を取得します。
    *   `device:take_picture`：デバイスのカメラを呼び出して写真を撮ります。
    *   `device:get_battery_level`：バッテリー残量を取得します。
*   **実装の考え方：** これらのツールの `execute` メソッドは、情報を取得するためにオペレーティングシステム（ iOS, Android, Windows ）固有の低層 API を呼び出します。これには通常、クロスプラットフォームのブリッジレイヤー（ React Native, Flutter, または Tauri の JS-Rust ブリッジなど）が必要になります。

#### `Listener` として（受動的な監視）

*   **プラグインタイプ：** `listener`
*   **例：**
    *   `device:accelerometer_listener`：加速度計の変化を継続的に監視します。
    *   `device:gps_location_listener`：地理的位置が大きく変化したときにトリガーされます。
*   **実装の考え方：**
    *   プラグインの `start(eventQueue)` メソッドは、システムレベルのイベントリスナーを登録します。
    *   物理デバイスのセンサーデータが変化すると、システムコールバックがトリガーされます。
    *   プラグインはセンサーデータ（例： `{ x: 0.1, y: -0.5, z: 9.8 }` ）を標準イベントとしてパッケージ化します。
    *   `eventQueue.push({ source: 'device', type: 'accelerometer_update', payload: ... })` を呼び出してイベントをコアのイベントキューにプッシュし、エージェントが物理世界の変化に反応できるようにします。
