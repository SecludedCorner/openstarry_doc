# 03. エージェント設計およびテンプレートサービス (Agent Design & Template Service)

このドキュメントでは、OpenStarry 調整レイヤーにおける「設計サブシステム」について詳しく説明します。これはエージェントの「遺伝子設計図」であるテンプレート (Templates) の管理を担当します。

## コア・ポジショニング：動的設計ワークショップ

OpenStarry アーキテクチャにおいて、**エージェントコアは実行者、オーケストレーターは管理者であり、本サービスは「造物主」のツール台です。**

これは単なる静的な JSON ファイルのデータベースではなく、人間や高度なエージェント（マスターエージェントなど）が API を通じてエージェントの役割を動的に作成、修正、インスタンス化できるようにする **ランタイムサービス** です。

---

## 機能と責務

### 1. テンプレート管理 (Template Management)
すべてのエージェントテンプレートの保存とバージョン管理を担当します。テンプレートは、エージェントの不変の属性を定義します。
*   **システムプロンプト (System Prompt):** コアとなる人格と指示。
*   **プラグイン・マニフェスト (Plugin Manifest):** ロードする必要のあるプラグインのリスト（能力リスト）。
*   **デフォルト設定 (Default Configuration):** デフォルトのパラメータ設定（LLM モデル、温度など）。

### 2. 設計インターフェース (Design Interface)
外部システムが設計作業を行うために呼び出す一連の標準 API を提供します。
*   `POST /templates`: 要件に基づいて新しいテンプレートを作成します。
*   `GET /templates/{id}`: テンプレートの詳細を取得します（デーモンがエージェントを起動する際に使用）。
*   `PUT /templates/{id}/plugins`: 既存のテンプレートに新しい能力を追加します。

---

## 人機協調設計プロセス

私たちは、 **「AI 支援による AI 設計 (AI-Assisted AI Design)」** モデルを推奨しています。

1.  **人間の意図:** 管理者がマスターエージェントに「ログ分析を専門とするアシスタントが必要だ」と伝えます。
2.  **マスターエージェントの推論:** マスターエージェントの LLM が要件を分析し、そのアシスタントには `fs:read` ツールと `log-analysis-plugin` が必要であると推論します。
3.  **設計サービスの呼び出し:** マスターエージェントは `AgentDesignerTool` を呼び出し、本サービスに API リクエストを送信します。
4.  **テンプレート生成:** 本サービスはリクエストを検証し、新しい `LogAnalyst_Template_v1` を生成して保存します。
5.  **インスタンス化:** その後、マスターエージェントはデーモンを呼び出し、その新しいテンプレートに基づいて作業用エージェントのインスタンスを起動します。

この設計により、OpenStarry は自己拡張と進化の能力を備えることができます。