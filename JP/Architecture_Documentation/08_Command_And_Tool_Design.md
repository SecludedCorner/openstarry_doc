# 07. コマンド (Command) の設計と位置付け

私たちのアーキテクチャにおいて、 `Command` (コマンド) は多層的な概念であり、コンテキストに応じてシステムの異なる部分で処理されます。このドキュメントの目的は、 `Command` と `Tool` (ツール) の関係を明確にし、アーキテクチャにおける具体的な位置付けを説明することです。

---

## 1. 「ユーザーシステムコマンド」として (UI プラグイン内)

これはユーザーに最も直接的に向けられたコマンドであり、LLM に任せるタスクではなく、エージェントクライアントやシステム自体を制御するために使用されます。

*   **定義：** `/help`, `/reset`, `/status` のように、特殊なプレフィックス（ `/` など）で始まる文字列。
*   **処理者：** **UI プラグイン (UI Plugin)**。
*   **ワークフロー：** `UI` プラグインはユーザー入力を受信すると、まずインターセプト（遮断）の判断を行います。システムコマンドであると認識された場合、 `UI` プラグイン自体が解析と処理を行い、「エージェントコア」の対話フローには入りません。この設計により、「システム」に対するユーザーの操作と、「エージェント」に対する対話タスクを明確に分離します。

---

## 2. 「ツール」の類義語として (ツールプラグイン内)

多くの文脈において、 `Command` と `Tool` の概念は互換性があります。

*   **定義：** `read_file` のように、LLM から呼び出し可能な、アトミック（原子化）で単一の責務を持つ機能関数。
*   **処理者：** **ツールプラグイン (Tool Plugin)**。エージェントコアの実行ループによってスケジューリングされます。
*   **結論：** アーキテクチャドキュメントでは、用語を統一するため、この種の機能を一貫して **`Tool`** と呼びます。したがって、 `Command` がこの意味で使用されている場合は、私たちの設計における `Tool` に対応します。

---

## 3. 「高階ワークフローコマンド」として (エージェント調整レイヤー内)

これは最も高度で強力なコマンドであり、複数のステップで構成される複雑なタスクを表します。

*   **定義：** 名前付きの、再利用可能な **「ワークフロー図 (Workflow Graph)」**。例えば、 `generate_weekly_report` という名前のコマンドは、データクエリ、チャート生成、LLM による要約、メール送信など、複数のノードを含むワークフローを背後に持っている可能性があります。
*   **処理者：** **エージェント調整レイヤー (Agent Coordination Layer)**。
*   **ワークフロー：**
    1.  ユーザー、定期タスク、または外部 API が高階コマンドをトリガーします。
    2.  エージェント調整レイヤーの **ルーティングコンポーネント** または **コマンドディスパッチャー** がリクエストを受信し、コマンド名を識別します。
    3.  調整レイヤーは、そのコマンドに対応する事前定義されたワークフロー図をロードします。
    4.  調整レイヤーの **ワークフローエンジン** が、その図の中のすべてのノードを実行し、複雑なタスク全体を完了させます。

この設計により、複雑なビジネスロジックをシンプルで呼び出し可能な「コマンド」としてカプセル化でき、システムの再利用性と能力の上限を大幅に向上させることができます。