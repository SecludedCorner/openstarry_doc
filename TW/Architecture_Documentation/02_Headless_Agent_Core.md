# 01. 無頭代理人核心

## 最終核心架構：一個純粹的「事件驅動執行引擎」

在「一切皆插件」和「保持核心絕對純淨」的最終設計哲學指導下，「無頭代理人核心」的定位被進一步精煉。它是一個**純粹的、單線程的、異步的「事件驅動執行引擎」**。

它的核心不再是針對 `UI` 或 `MCP` 的特定「鉤子 (Hook)」，而是**一個統一的「內部事件隊列 (Internal Event Queue)」**。核心的所有行為都由處理此隊列中的事件來驅動。

## 核心職責概述

代理人核心的職責可以被看作是圍繞「事件隊列」構建的一套標準化處理流程。

1.  **事件隊列 (Internal Event Queue) - [新核心]**:
    *   作為核心**唯一的輸入源**，接收來自各類「監聽器插件」的標準化事件。
2.  **執行循環 (Execution Loop) - [職責簡化]**:
    *   不再監聽外部，只負責從「事件隊列」中取出事件，並根據事件類型觸發後續流程（通常是打包上下文並調用 LLM）。
3.  **插件基礎設施 (Plugin Infrastructure):**
    *   職責不變，但新增了對 **`listener`** 類型插件的支持。
4.  **監聽器插件 (Listener Plugin) - [受蘊]**:
    *   一種主動的、長時程運行的插件，負責**將外部的異步事件轉化為標準事件**並推入「事件隊列」。
    *   例如，CLI stdin 監聽器接收用戶終端輸入，並將其作為 `user_input` 事件推入隊列。
    *   `MCP` 的消息接收能力，則由一個 `MCP_Listener` 插件來實現。
5.  **UI 插件 (UI Plugin) - [色蘊]**:
    *   UI 插件有獨立的 `IUI` 介面，負責接收事件並呈現輸出。
    *   Listener 插件 (受蘊) 專注於接收外部輸入。兩者各司其職，不再混合。
6.  **安全層 (Security Layer) & 狀態管理器 (State Manager):**
    *   職責維持不變，依然是執行循環中的關鍵處理環節。

---

通過這次精煉，核心本身變得與任何特定的輸入源（UI、消息總線、Webhook）完全解耦。只要一個功能可以被實現為一個向「事件隊列」推送消息的 `Listener` 插件，核心就能處理它。這為系統提供了極致的靈活性和純粹性。