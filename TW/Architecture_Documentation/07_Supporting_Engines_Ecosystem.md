# 06. 支撐引擎生態系統 (Supporting Engines Ecosystem)

在 `代理人核心` (執行交互) 和 `代理協調層` (編排流程) 之外，要構建一個完整的、生產級的代理人系統，還需要一系列獨立的、專業化的「支撐引擎」。

## 設計抉擇：內置功能 vs. 外部服務

一個很自然的疑問是：這些引擎的功能（如記憶、安全）是否應該直接內置於代理人核心之中？

答案是否定的。將這些複雜的功能作為**獨立的外部服務（引擎）**，而不是核心的**內置部分**，是構建可擴展、可維護系統的關鍵。

我們可以再次借鑒操作系統的設計哲學來理解：**代理人核心是「內核」(Kernel)，而這些支撐引擎是運行在內核之上的、獨立的「服務程序」(Server Programs)。**

*   **內核**提供基礎能力（進程調度、內存管理、文件 IO），但它本身不包含數據庫或 CI/CD 工具。
*   **數據庫 (如 PostgreSQL)** 作為獨立服務運行，利用內核的 IO 能力來存儲和查詢海量數據。
*   **CI/CD 平台 (如 Jenkins)** 作為獨立工具，用於調度和測試其他應用程序。

將功能分離為獨立引擎的好處是：

*   **單一職責原則：** 讓代理人核心保持輕量，只專注於協調對話，從而易於維護。
*   **獨立擴展性：** 記憶引擎（數據密集型）和代理人核心（計算密集型）的擴展方式不同，分離後可獨立擴展。
*   **複用與集中化：** 一個記憶引擎或策略引擎可以被成百上千個代理人實例共享，確保了數據和規則的一致性。
*   **團隊專業化：** 允許不同的團隊專注於優化不同的引擎。

---

## 部署模式：服務 vs. 插件

雖然這些引擎在邏輯上是獨立的，但在物理部署上，它們支持兩種模式，以適應不同的規模需求：

1.  **遠程微服務模式 (Remote Microservices):** 
    *   適用於大規模生產環境。
    *   引擎作為獨立的 Docker 容器或 Serverless 函數運行（例如 AWS Lambda, K8s Pods）。
    *   代理人通過標準網絡協議 (HTTP/gRPC) 訪問它們。

2.  **本地基礎設施插件模式 (Local Infrastructure Plugins):**
    *   適用於單機開發或輕量級部署。
    *   引擎被封裝為 `infrastructure` 類型的插件，由 **Orchestrator Daemon** 直接加載和運行。
    *   例如，一個 `Local_VectorDB_Plugin` 可以在本地啟動一個嵌入式的 ChromaDB 實例，供所有代理人共享使用。

---

## 三大關鍵支撐引擎

### 1. 記憶與 RAG 引擎 (Memory & RAG Engine)

*   **定位：** 代理人生態的「圖書館」與「檔案室」，是統一的知識與記憶中心。
*   **類比：** 一個獨立的**數據庫服務 (如 Elasticsearch + PostgreSQL)**。
*   **核心職責：**
    1.  **數據攝入與向量化：** 提供自動化流水線，處理、切塊並向量化各種來源的數據。
    2.  **知識庫管理：** 管理底層的向量數據庫和元數據。
    3.  **複雜查詢：** 提供支持混合搜索、過濾等功能的高級查詢接口。
    4.  **長期記憶合成：** 通過對話反思，主動為代理人生成結構化的長期記憶。
*   **協同方式：** 「代理人核心」通過向此引擎發起查詢來獲取上下文信息。

### 2. 評估與測試引擎 (Evaluation & Testing Engine)

*   **定位：** 代理人生態的「質量控制部 (QC)」。
*   **類比：** 一個獨立的**CI/CD 與測試平台 (如 Jenkins)**。
*   **核心職責：**
    1.  **測試用例管理：** 維護用於評估的標準數據集。
    2.  **評估執行：** 批量化、可重複地運行代理人或工作流以處理測試用例。
    3.  **指標計算：** 自動計算答案真實性、工具使用準確性、成本、延遲等關鍵指標。
    4.  **結果報告：** 生成可視化報告，用於對比不同版本代理人的性能。
*   **協同方式：** 開發者使用此引擎來「運行」和「測試」他們開發的代理人核心和協調層工作流。

### 3. 策略與安全護欄引擎 (Policy & Guardrails Engine)

*   **定位：** 代理人生態的「保安與合規部」。
*   **類比：** 一個獨立的**企業級認證授權中心 (如 Active Directory)**。
*   **核心職責：**
    1.  **策略定義：** 提供一種語言來定義細粒度的安全、隱私和行為策略（例如，能訪問哪些文件、能調用哪些 API、內容生成需要遵循的規則等）。
    2.  **策略執行：** 提供高性能的查詢接口，供其他組件在執行敏感操作前進行權限檢查。
    3.  **審計日誌：** 記錄所有策略決策，以備安全審計。
*   **協同方式：** 「代理人核心」的「安全層」在收到工具調用請求時，不再是簡單地詢問用戶，而是向此引擎發起「是否允許」的查詢。
